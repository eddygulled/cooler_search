<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
</head>
<style>
    .mapboxgl-marker .mapboxgl-marker-anchor-center {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .mapboxgl-popup {
        max-width: 300px;
    }

    .mapboxgl-popup-content {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
    }
</style>

<body>
    <div class="container-fluid bg-light p-3">
        <div class="row">
            <div class="col-3">
                <a class="navbar-brand" href="#">Cooler Verification Mapping</a>
            </div>
            <div class="col-sm-12 col-md-4 my-1">
                <select name="" id="time_jump" class="form-control mr-sm-2">
                    <option value="0">Last Scanned</option>

                    <option value="1">past 1 week</option>
                    <option value="2">past 2 weeks</option>
                    <option value="3">past 3 weeks</option>
                    <option value="4">past 4 weeks</option>

                </select>

            </div>
            <div class="col-sm-12 col-lg-4 mb-1">
                <select name="" id="center" class="form-control mr-sm-2">
                    <option value="0">Branch</option>
                    <option value='KIMARO TRADERS KD'>KIMARO TRADERS KD</option>
                    <option value='MAKETE OCCD'>MAKETE OCCD</option>
                    <option value='AFROEURO OCCD'>AFROEURO OCCD</option>
                    <option value='CHANIKA SSD'>CHANIKA SSD</option>
                    <option value='TEMEKE SSD STOCKIST'>TEMEKE SSD STOCKIST</option>
                    <option value='CHALINZE SSD RETAIL'>CHALINZE SSD RETAIL</option>
                    <option value='MUSTAFA OCCD'>MUSTAFA OCCD</option>
                    <option value='BUGURUNI SSD'>BUGURUNI SSD</option>
                    <option value='MSHEWE BUSINESS CENTER'>MSHEWE BUSINESS CENTER</option>
                    <option value='ITUMBA OCCD-ILEJE'>ITUMBA OCCD-ILEJE</option>
                    <option value='SANGA OCCD'>SANGA OCCD</option>
                    <option value='EXODUS OCCD'>EXODUS OCCD</option>
                    <option value='MUSHI OCCD'>MUSHI OCCD</option>
                    <option value='KIBAMBA SSD RETAIL'>KIBAMBA SSD RETAIL</option>
                    <option value='TABATA SSD'>TABATA SSD</option>
                    <option value='KINONDONI SSD RETAILER'>KINONDONI SSD RETAILER</option>
                    <option value='SHANGWE MDC'>SHANGWE MDC</option>
                    <option value='SAHARA SHOPPING-KEY DISTRIBUTOR'>SAHARA SHOPPING-KEY DISTRIBUTOR</option>
                    <option value='MWENGE SOUTH KD'>MWENGE SOUTH KD</option>
                    <option value='BAKIRI & SONS CO. KD MASASI'>BAKIRI & SONS CO. KD MASASI</option>
                    <option value='SFK OCCD'>SFK OCCD</option>
                    <option value='MBEYA URBAN SSD RETAILER'>MBEYA URBAN SSD RETAILER</option>
                    <option value='TEGETA-BAGAMOYO SSD'>TEGETA-BAGAMOYO SSD</option>
                    <option value='DSD MPANDA'>DSD MPANDA</option>
                    <option value='E.MAHENGE KEY DISTRIBUTOR (VWAWA )'>E.MAHENGE KEY DISTRIBUTOR (VWAWA )</option>
                    <option value='KIBO EMPIRE OCCD'>KIBO EMPIRE OCCD</option>
                    <option value='KEY ACCOUNTS'>KEY ACCOUNTS</option>
                    <option value='KOROGWE SSD RETAIL'>KOROGWE SSD RETAIL</option>
                    <option value='ASSENGA ASSOCIATES CO. LTD'>ASSENGA ASSOCIATES CO. LTD</option>
                    <option value='HELENA MBWINGA OCCD'>HELENA MBWINGA OCCD</option>
                    <option value='DSD'>DSD</option>
                    <option value='MKURANGA SSD'>MKURANGA SSD</option>
                    <option value='KIMBINYIKO INTERPRISE LTD OCCD'>KIMBINYIKO INTERPRISE LTD OCCD</option>
                    <option value='SILVER OCCD'>SILVER OCCD</option>
                    <option value='TANGA MJINI SSD RETAIL'>TANGA MJINI SSD RETAIL</option>
                    <option value='MANYUNYU TRADERS LTD -KD'>MANYUNYU TRADERS LTD -KD</option>
                    <option value='MWAMPETELE OCCD '>MWAMPETELE OCCD </option>
                    <option value='NEW MILLENIUM DEPORT MDC'>NEW MILLENIUM DEPORT MDC</option>
                    <option value='KIKOKO COMPANY LTD-KEY DISTRIB'>KIKOKO COMPANY LTD-KEY DISTRIB</option>
                    <option value='MWASIKILI OCCD'>MWASIKILI OCCD</option>
                    <option value='MBEYA URBAN SSD STOCKIST'>MBEYA URBAN SSD STOCKIST</option>
                    <option value='MSELEM KEY DISTR-SUMBAWANGA'>MSELEM KEY DISTR-SUMBAWANGA</option>
                    <option value='TUNDUMA SSD RETAIL'>TUNDUMA SSD RETAIL</option>
                    <option value='MGIMWA OCCD'>MGIMWA OCCD</option>
                    <option value='ZENJ ENTERPRISES OCCD'>ZENJ ENTERPRISES OCCD</option>
                    <option value='EMMA KIBURUNGWA'>EMMA KIBURUNGWA</option>
                    <option value='LINDI SSD'>LINDI SSD</option>
                    <option value='CHALINZE SSD STOCKIST'>CHALINZE SSD STOCKIST</option>
                    <option value='TANGA MJINI SSD STOCKIST'>TANGA MJINI SSD STOCKIST</option>
                    <option value='SAMWEL OCCD'>SAMWEL OCCD</option>
                    <option value='GREYSON KEY DISTRIBUTOR'>GREYSON KEY DISTRIBUTOR</option>
                    <option value='MTWARA SSD RETAIL'>MTWARA SSD RETAIL</option>
                    <option value='FURAHA OLIVER GIFT KEY DISTRIBUTOR'>FURAHA OLIVER GIFT KEY DISTRIBUTOR</option>
                    <option value='SMART STORE OCCD'>SMART STORE OCCD</option>
                    <option value='IFAKARA SSD'>IFAKARA SSD</option>
                    <option value='POPATI ASSOCIATE COMPANY LTD OCCD'>POPATI ASSOCIATE COMPANY LTD OCCD</option>
                    <option value='HUBERT KIMEI OCCD'>HUBERT KIMEI OCCD</option>
                    <option value='NEEVA OCCD'>NEEVA OCCD</option>
                    <option value='EMMANUEL OCCD'>EMMANUEL OCCD</option>
                    <option value='KOROGWE SSD STOCKIST'>KOROGWE SSD STOCKIST</option>
                    <option value='UFUNUO GAMA OCCD'>UFUNUO GAMA OCCD</option>
                    <option value='SIWALE OCCD'>SIWALE OCCD</option>
                    <option value='KILOSA HAJI MDC'>KILOSA HAJI MDC</option>
                    <option value='SONGEA SSD'>SONGEA SSD</option>
                    <option value='OMAKA CO LTD OCCD'>OMAKA CO LTD OCCD</option>
                    <option value='NJOMBE SSD RETAIL'>NJOMBE SSD RETAIL</option>
                    <option value='ROY MDC'>ROY MDC</option>
                    <option value='FK & CF INVESTMENT COMPANY'>FK & CF INVESTMENT COMPANY</option>
                    <option value='FURAHA D. MUHAGAMA OCCD'>FURAHA D. MUHAGAMA OCCD</option>
                    <option value='KIBAMBA SSD STOCKIST'>KIBAMBA SSD STOCKIST</option>
                    <option value='AWAMU STORE KD'>AWAMU STORE KD</option>
                    <option value='MATUNDASI (MDC)'>MATUNDASI (MDC)</option>
                    <option value='MAKONGOLOSI (MDC)'>MAKONGOLOSI (MDC)</option>
                    <option value='CHUNYA (MDC) - NDELWA'>CHUNYA (MDC) - NDELWA</option>
                    <option value='SHAYO MDC - KASUMULU'>SHAYO MDC - KASUMULU</option>
                    <option value='SIMIKE GENERAL SUPPLIES'>SIMIKE GENERAL SUPPLIES</option>
                    <option value='SUNLIT INVESTMENT CO.LTD (KEY DISTR'>SUNLIT INVESTMENT CO.LTD (KEY DISTR</option>
                    <option value='LUFILYO MDC'>LUFILYO MDC</option>
                    <option value='ELIAS SANGA OCCD'>ELIAS SANGA OCCD</option>
                    <option value='M.M GULEKELA OCCD'>M.M GULEKELA OCCD</option>
                    <option value='BENTAS OCCD'>BENTAS OCCD</option>
                    <option value='EDDY MDC'>EDDY MDC</option>
                    <option value='RAHA LEO OCCD'>RAHA LEO OCCD</option>
                    <option value='KUMBULU MDC'>KUMBULU MDC</option>
                    <option value='MURAGANE ENTERPRISES OCCD'>MURAGANE ENTERPRISES OCCD</option>
                    <option value='LUPA MDC'>LUPA MDC</option>
                    <option value='BRIGHT FUTURE CO.LTD'>BRIGHT FUTURE CO.LTD</option>
                    <option value='THE MOONLIGHT COMPANY LTD'>THE MOONLIGHT COMPANY LTD</option>
                    <option value='MAKAMBAKO STORE MDC'>MAKAMBAKO STORE MDC</option>
                    <option value='MTWARA SSD STOCKIST'>MTWARA SSD STOCKIST</option>
                    <option value='NJOMBE SSD STOCKIST'>NJOMBE SSD STOCKIST</option>
                    <option value='MWAKILEMA'>MWAKILEMA</option>
                    <option value='MIRAAZI OCCD'>MIRAAZI OCCD</option>
                    <option value='LEOKADIA CHAULA'>LEOKADIA CHAULA</option>
                    <option value='MWAKILEMA MDC'>MWAKILEMA MDC</option>
                    <option value='SANGAMBI MDC'>SANGAMBI MDC</option>
                    <option value='TUNDUMA SSD STOCKIST'>TUNDUMA SSD STOCKIST</option>
                    <option value='MBUYUNI KUNDUCHI'>MBUYUNI KUNDUCHI</option>
                    <option value='MBEPERA MDC'>MBEPERA MDC</option>
                    <option value='TEMEKE SSD RETAIL'>TEMEKE SSD RETAIL</option>

                </select>
            </div>
            <div class="col-sm-12 col-lg-1">
                <span class="form-control btn btn-light" id="filter">search</span>
            </div>
        </div>
    </div>

    <div class="container-fluid bg-dark">
        <div class="row">
            <div id="map" class="col-12">

            </div>
        </div>
    </div>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>
<script src="https://releases.jquery.com/git/jquery-3.x-git.js"></script>


<script>
    var data;
    try{
        data = JSON.parse("{{row_list | escapejs}}")
    } catch{
        // ??
    }
</script>

<script>
    var init_center = null;
    var init_time = null;
    // inpect local storage
    if(localStorage.getItem("center") == undefined){

    }else{
        init_center = localStorage.getItem("center")
        init_time = localStorage.getItem("time_jump")
    }
    
    var map = null;
    $(document).ready(function () {
        // initialize boxes
        if(init_center != null && init_time != null){
            $("#center").val(init_center)
        }

        $("#map").css({
            "height": (innerHeight - 70) + "px"
        })


        mapboxgl.accessToken = 'pk.eyJ1IjoiZWRkaWVndWxsZWQiLCJhIjoiY2w5NWppb2JnMDJiazNubG42dnJmaWhpeSJ9.ypTxiUIVKR1bjuqbgUHR2g';
        map = new mapboxgl.Map({
            container: 'map', // container ID

            style: 'mapbox://styles/mapbox/streets-v11',
            center: [39.178326, -6.776012],
            zoom: 10,
            projection: 'globe'
        });

        map.on('style.load', () => {
            map.setFog({});
        });


        if (data != undefined) {
            for (var i = 0; i < data.length; i++) {
                var coordinates = [parseFloat(data[i].longitude), parseFloat(data[i].latitude)]
                new mapboxgl.Marker({ color: 'red', rotation: 0 })
                    .setLngLat(coordinates)
                    .setPopup(
                        new mapboxgl.Popup({ offset: 25 }) // add popups
                            .setHTML(
                                "<div class='card'> " +
                                "<div class='card-body'>" +
                                "<table class='table'>" +
                                "<tr>" +
                                "<th> Outlet Number</th>" +
                                "<td>" + data[i].outlet_number + "</td></tr>" +
                                "<th> Outlet Name</th>" +
                                "<td>" + data[i].outlet_name + "</td></tr>" +
                                "<th> Mobile Number</th>" +
                                "<td>" + data[i].mobile_number + "</td></tr>" +
                                "<th> Outlet Location</th>" +
                                "<td>" + data[i].outlet_location + "</td></tr>" +
                                "<th> RAD</th>" +
                                "<td>" + data[i].rad + "</td></tr>" +
                                "<th> ASM </th>" +
                                "<td>" + data[i].asm + "</td></tr>" +
                                "<th> Last Scanned </th>" +
                                "<td>" + data[i].last_scanned + "</td></tr>" +
                                "</tr>" +
                                "</table>" +
                                "</div> </div>"
                            )
                    )
                    .addTo(map);
            }
        }
    });

    // event triggers
    $("#filter").on('click', function () {
        $_center = $("#center").val();
        $_time_jump = $("#time_jump").val();

        if ($_center != 0 && $_time_jump != 0) { window.location.href = "/cvm/" + $_time_jump + "/" + $_center; localStorage.setItem("center", $_center); localStorage.setItem("time_jump", $_center)}

    });
</script>



</html>